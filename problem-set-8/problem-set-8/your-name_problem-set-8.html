<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zahid Asghar">
<meta name="dcterms.date" content="2023-01-03">

<title>Problem set 8: The Health Insurance Subsidy Program</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="your-name_problem-set-8_files/libs/clipboard/clipboard.min.js"></script>
<script src="your-name_problem-set-8_files/libs/quarto-html/quarto.js"></script>
<script src="your-name_problem-set-8_files/libs/quarto-html/popper.min.js"></script>
<script src="your-name_problem-set-8_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="your-name_problem-set-8_files/libs/quarto-html/anchor.min.js"></script>
<link href="your-name_problem-set-8_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="your-name_problem-set-8_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="your-name_problem-set-8_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="your-name_problem-set-8_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="your-name_problem-set-8_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="your-name_problem-set-8_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="your-name_problem-set-8_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#task-1-rcts" id="toc-task-1-rcts" class="nav-link active" data-scroll-target="#task-1-rcts">Task 1: RCTs</a></li>
  <li><a href="#task-2-inverse-probability-weighting-andor-matching" id="toc-task-2-inverse-probability-weighting-andor-matching" class="nav-link" data-scroll-target="#task-2-inverse-probability-weighting-andor-matching">Task 2: Inverse probability weighting and/or matching</a></li>
  <li><a href="#task-3-diff-in-diff" id="toc-task-3-diff-in-diff" class="nav-link" data-scroll-target="#task-3-diff-in-diff">Task 3: Diff-in-diff</a></li>
  <li><a href="#task-4-rdd" id="toc-task-4-rdd" class="nav-link" data-scroll-target="#task-4-rdd">Task 4: RDD</a></li>
  <li><a href="#task-5-ivs2sls" id="toc-task-5-ivs2sls" class="nav-link" data-scroll-target="#task-5-ivs2sls">Task 5: IVs/2SLS</a></li>
  <li><a href="#task-6-summary" id="toc-task-6-summary" class="nav-link" data-scroll-target="#task-6-summary">Task 6: Summary</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Problem set 8: The Health Insurance Subsidy Program</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zahid Asghar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 3, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)     <span class="co"># For ggplot, mutate(), filter(), and friends</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)         <span class="co"># For converting models to data frames</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr)      <span class="co"># For lm_robust() and iv_robust()</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)  <span class="co"># For showing side-by-side regression tables</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)       <span class="co"># For matching</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdrobust)      <span class="co"># For nonparametric RD</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rddensity)     <span class="co"># For nonparametric RD density tests</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)         <span class="co"># For reading Stata files</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)  <span class="co"># Make any random stuff be the same every time you run this</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Round everything to 3 digits by default</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"digits"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn off the message that happens when you use group_by() and summarize()</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Load raw data</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>hisp_raw <span class="ot">&lt;-</span> <span class="fu">read_stata</span>(<span class="st">"data/evaluation.dta"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Make nice clean dataset to use for the rest of the assignment</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>hisp <span class="ot">&lt;-</span> hisp_raw <span class="sc">%&gt;%</span> </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Having a numeric 0/1 column is sometimes helpful for things that don't like</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># categories, like matchit()</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">enrolled_num =</span> enrolled) <span class="sc">%&gt;%</span> </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert these 0/1 values to actual categories</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">eligible =</span> <span class="fu">factor</span>(eligible, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Not eligible"</span>, <span class="st">"Eligible"</span>)),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">enrolled =</span> <span class="fu">factor</span>(enrolled, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Not enrolled"</span>, <span class="st">"Enrolled"</span>)),</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">round =</span> <span class="fu">factor</span>(round, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Before"</span>, <span class="st">"After"</span>)),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_locality =</span> <span class="fu">factor</span>(treatment_locality, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treatment"</span>)),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">promotion_locality =</span> <span class="fu">factor</span>(promotion_locality, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No promotion"</span>, <span class="st">"Promotion"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get rid of this hospital column because (1) we're not using it, and (2) half</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of the households are missing data, and matchit() complains if any data is</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># missing, even if you're not using it</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hospital)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The World Bank’s <em>Impact Evaluation in Practice</em> has used a hypothetical example of a health insurance program throughout the book. This Health Insurance Subsidy Program (HISP) provides subsidies for buying private health insurance to poorer households, with the goal of lowering personal health expenditures, since people can rely on insurance coverage instead of paying out-of-pocket. Think of the HISP as a version of the Affordable Care Act (ACA, commonly known as Obamacare).</p>
<p>The dataset includes a number of important variables you’ll use throughout this assignment:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>health_expenditures</code></td>
<td>Out of pocket health expenditures (per person per year)</td>
</tr>
<tr class="even">
<td><code>eligible</code></td>
<td>Household eligible to enroll in HISP</td>
</tr>
<tr class="odd">
<td><code>enrolled</code></td>
<td>Household enrolled in HISP</td>
</tr>
<tr class="even">
<td><code>round</code></td>
<td>Indicator for before and after intervention</td>
</tr>
<tr class="odd">
<td><code>treatment_locality</code></td>
<td>Household is located in treatment community</td>
</tr>
<tr class="even">
<td><code>poverty_index</code></td>
<td>1-100 scale of poverty</td>
</tr>
<tr class="odd">
<td><code>promotion_locality</code></td>
<td>Household is located in community that received random promotion</td>
</tr>
<tr class="even">
<td><code>enrolled_rp</code></td>
<td>Household enrolled in HISP following random promotion</td>
</tr>
</tbody>
</table>
<p>It also includes several demographic variables about the households. <strong>Each of these are backdoor confounders between health expenditures participation in the HISP</strong>:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>age_hh</code></td>
<td>Age of the head of household (years)</td>
</tr>
<tr class="even">
<td><code>age_sp</code></td>
<td>Age of the spouse (years)</td>
</tr>
<tr class="odd">
<td><code>educ_hh</code></td>
<td>Education of the head of household (years)</td>
</tr>
<tr class="even">
<td><code>educ_sp</code></td>
<td>Education of the spouse (years)</td>
</tr>
<tr class="odd">
<td><code>female_hh</code></td>
<td>Head of household is a woman (1 = yes)</td>
</tr>
<tr class="even">
<td><code>indigenous</code></td>
<td>Head of household speaks an indigenous language (1 = yes)</td>
</tr>
<tr class="odd">
<td><code>hhsize</code></td>
<td>Number of household members</td>
</tr>
<tr class="even">
<td><code>dirtfloor</code></td>
<td>Home has a dirt floor (1 = yes)</td>
</tr>
<tr class="odd">
<td><code>bathroom</code></td>
<td>Home has a private bathroom (1 = yes)</td>
</tr>
<tr class="even">
<td><code>land</code></td>
<td>Number of hectares of land owned by household</td>
</tr>
<tr class="odd">
<td><code>hospital_distance</code></td>
<td>Distance to closest hospital (km)</td>
</tr>
</tbody>
</table>
<p>You will use each of the five main econometric approaches for estimating causal effects to measure the effect of HISP on household health expenditures. <strong>Don’t worry about conducting in-depth baseline checks and robustness checks.</strong> For the sake of this assignment, you’ll do the minimum amount of work for each method to determine the causal effect of the program.</p>
<section id="task-1-rcts" class="level1">
<h1>Task 1: RCTs</h1>
<p>To measure the effect of HISP accurately, World Bank researchers randomly assigned different localities (villages, towns, cities, whatever) to treatment and control groups. Some localities were allowed to join HISP; others weren’t.</p>
<p>Here’s what you should do:</p>
<ul>
<li>Make a new dataset that only looks at eligible households (<code>filter(eligible == "Eligible")</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>hisp_eligible<span class="ot">&lt;-</span>hisp<span class="sc">|&gt;</span><span class="fu">filter</span>(eligible<span class="sc">==</span><span class="st">'Eligible'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Make a new dataset that only looks at eligible households <em>after</em> the experiment (<code>filter(round == "After")</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>hisp_eligible<span class="ot">&lt;-</span>hisp_eligible<span class="sc">|&gt;</span><span class="fu">filter</span>(round<span class="sc">==</span><span class="st">'After'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Calculate the average health expenditures in treatment and control localities (<code>treatment_locality</code>) <em>before</em> the intervention (<code>round == "Before"</code>). Were expenditures fairly balanced across treatment and control groups before the intervention?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>hisp<span class="sc">|&gt;</span><span class="fu">group_by</span>(treatment_locality)<span class="sc">|&gt;</span><span class="fu">filter</span>(round<span class="sc">==</span><span class="st">'Before'</span>)<span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_exp=</span><span class="fu">mean</span>(health_expenditures))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  treatment_locality avg_exp
  &lt;fct&gt;                &lt;dbl&gt;
1 Control               17.4
2 Treatment             17.0</code></pre>
</div>
</div>
<ul>
<li>Calculate the average health expenditures in treatment and control localities <em>after</em> the intervention (<code>round == "After"</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>hisp<span class="sc">|&gt;</span><span class="fu">group_by</span>(treatment_locality)<span class="sc">|&gt;</span><span class="fu">filter</span>(round<span class="sc">==</span><span class="st">'After'</span>)<span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_exp=</span><span class="fu">mean</span>(health_expenditures))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  treatment_locality avg_exp
  &lt;fct&gt;                &lt;dbl&gt;
1 Control               20.1
2 Treatment             13.7</code></pre>
</div>
</div>
<ul>
<li>Determine the difference in average health expenditures across treatment and control <em>after</em> the intervention</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fl">17.98-7.84</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.1</code></pre>
</div>
</div>
<ul>
<li>Using data <em>after</em> the intervention, use linear regression to determine the difference in means and statistical significance of the difference (hint: you’ll want to use <code>health_expenditures ~ treatment_locality</code>). Use <code>lm_robust()</code> from the <strong>estimatr</strong> package and cluster by <code>locality_identifier</code> if you’re feeling adventurous.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>m_after<span class="ot">&lt;-</span><span class="fu">lm_robust</span>(health_expenditures<span class="sc">~</span>treatment_locality, <span class="at">clusters =</span> locality_identifier,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> hisp<span class="sc">|&gt;</span><span class="fu">filter</span>(round<span class="sc">==</span><span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Create another model that controls for the following variables: <code>age_hh + age_sp + educ_hh + educ_sp + female_hh + indigenous + hhsize + dirtfloor + bathroom + land + hospital_distance</code>. (Use <code>lm_robust()</code> again if you’re brave.) Does the estimate of the causal effect change?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>m_after_control<span class="ot">&lt;-</span><span class="fu">lm_robust</span>(health_expenditures<span class="sc">~</span>treatment_locality<span class="sc">+</span>age_hh <span class="sc">+</span> age_sp <span class="sc">+</span> educ_hh <span class="sc">+</span> educ_sp <span class="sc">+</span> female_hh <span class="sc">+</span> indigenous <span class="sc">+</span> hhsize <span class="sc">+</span> dirtfloor <span class="sc">+</span> bathroom <span class="sc">+</span> land <span class="sc">+</span> hospital_distance, <span class="at">clusters =</span> locality_identifier,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> hisp<span class="sc">|&gt;</span><span class="fu">filter</span>(round<span class="sc">==</span><span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Show the results from the two regressions in a side-by-side table if you want</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>models<span class="ot">&lt;-</span><span class="fu">list</span>(m_after,m_after_control)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Do that here, either in one big chunk, or in smaller chunks with text in</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># between where you answer the questions (preferred)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(models)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 20.064 </td>
   <td style="text-align:center;"> 28.957 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.379) </td>
   <td style="text-align:center;"> (0.809) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatment_localityTreatment </td>
   <td style="text-align:center;"> −6.406 </td>
   <td style="text-align:center;"> −6.130 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.504) </td>
   <td style="text-align:center;"> (0.402) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age_hh </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.108 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.015) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age_sp </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.008 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.016) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educ_hh </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.113 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.046) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educ_sp </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.010 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.050) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> female_hh </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 1.090 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.474) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> indigenous </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −2.806 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.375) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hhsize </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −2.382 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.064) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dirtfloor </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −3.044 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.298) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> bathroom </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.971 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.255) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> land </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.165 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.040) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hospital_distance </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.006 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.005) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 9914 </td>
   <td style="text-align:center;"> 9914 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.073 </td>
   <td style="text-align:center;"> 0.344 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 76481.6 </td>
   <td style="text-align:center;"> 73066.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 76503.2 </td>
   <td style="text-align:center;"> 73167.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 11.45 </td>
   <td style="text-align:center;"> 9.63 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Std.Errors </td>
   <td style="text-align:center;"> by: locality_identifier </td>
   <td style="text-align:center;"> by: locality_identifier </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="task-2-inverse-probability-weighting-andor-matching" class="level1">
<h1>Task 2: Inverse probability weighting and/or matching</h1>
<p>Instead of using experimental data, we can estimate the causal effect using observational data alone by closing all the confounding backdoors. In this task, you should <strong>choose one of two approaches</strong>: inverse probability weighting or matching. <strong>AGAIN: you only need to do one of these</strong>. You can do both for fun, but you only need to do <strong>one</strong>.</p>
<p>Do the following (for both approaches):</p>
<ul>
<li>Make a dataset based on <code>hisp</code> that only includes observations from after the intervention (<code>round == "After"</code>). Even though you technically have a column that indicates if the household was in the treatment group (<code>treatment_locality</code>), you’re going to pretend that you don’t have it This is now observational data—all you know is that a bunch of households participated in HISP and a bunch didn’t.</li>
<li>Run a naive model that estimates the effect of HISP enrollment on health expenditures (<code>health_expenditures ~ enrolled</code>) using this after-only observational data. What is the effect? Is this accurate? Why or why not?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do that here, either in one big chunk, or in smaller chunks with text in</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between where you answer the questions (preferred)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>naive<span class="ot">&lt;-</span><span class="fu">lm</span>(health_expenditures <span class="sc">~</span> enrolled,<span class="at">data =</span> hisp<span class="sc">|&gt;</span><span class="fu">filter</span>(round<span class="sc">==</span><span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>If you’re using inverse probability weighting</em></strong>, do the following:</p>
<ul>
<li>Use logistic regression to model the probability of enrolling in the HISP. Hint: you’ll need to use <code>glm()</code> (replace stuff in <code>&lt;&gt;</code> like <code>&lt;THINGS&gt;</code> with actual column names or dataset names). Also, note that this code below isn’t in an actual R chunk, so don’t try to run it.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(enrolled <span class="sc">~</span> COUNFOUNDER1 <span class="sc">+</span> COUNFOUNDER2 <span class="sc">+</span> ...,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> hisp<span class="sc">|&gt;</span><span class="fu">filter</span>(round<span class="sc">==</span><span class="st">'After'</span>),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Generate propensity scores for enrollment in the HISP using something like this code (again, this isn’t a chunk; don’t try to run it):</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>enrolled_propensities <span class="ot">&lt;-</span> <span class="fu">augment_columns</span>(MODEL_NAME, NAME_OF_YOUR_AFTER_DATASET, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">p_enrolled =</span> .fitted)                                         </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Add a new column to <code>enrolled_propensities</code> with <code>mutate()</code> that calculates the inverse probability weights using this formula (hint: “propensity” will be <code>p_enrolled</code>; “Treatment” will be <code>treatment_num</code>):</li>
</ul>
<p><span class="math display">\[
\frac{\text{Treatment}}{\text{Propensity}} + \frac{1 - \text{Treatment}}{1 - \text{Propensity}}
\]</span></p>
<ul>
<li>Run a model that estimates the effect of HISP enrollment on health expenditures (<code>health_expenditures ~ enrolled</code>) using the <code>enrolled_propensities</code> data, weighting by your new inverse probability weights column. What is the causal effect of HISP on health expenditures? How does this compare to the naive model? Which do you believe more? Why?</li>
<li>Show the results from the two regressions in a side-by-side table if you want</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do that here, either in one big chunk, or in smaller chunks with text in</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between where you answer the questions (preferred)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>If you’re using matching</em></strong>, do the following:</p>
<ul>
<li>Use <code>matchit()</code> to find the best matches for enrollment based on Mahalanobis nearest neighbor matching. The <code>matchit()</code> function can’t work with categorical variables, so make sure you use <code>enrolled_num</code> instead of <code>enrolled</code>. Use code similar to this (replace stuff in <code>&lt;&gt;</code> like <code>&lt;THINGS&gt;</code> with actual column names or dataset names). Also, note that this code below isn’t in an actual R chunk, so don’t try to run it.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>matched <span class="ot">&lt;-</span> <span class="fu">matchit</span>(enrolled_num <span class="sc">~</span> COUNFOUNDER1 <span class="sc">+</span> COUNFOUNDER2 <span class="sc">+</span> ..., </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> NAME_OF_YOUR_AFTER_DATASET,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"nearest"</span>, <span class="at">distance =</span> <span class="st">"mahalanobis"</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>It might take a minute to run the matching. If you include `cache=TRUE` in the chunk options, R will keep track of when the chunk changes; if you knit and there's been a change to the chunk, R will run the chunk, but if you knit and there's been no changes, R will use the previous output of the chunk and not actually run it. </code></pre>
<ul>
<li>Run <code>summary(matched)</code> and see how many rows were matched and how many will be discarded.</li>
<li>Use <code>match.data()</code> to store the results of the match as a new dataset.</li>
<li>Run a model that estimates the effect of HISP enrollment on health expenditures (<code>health_expenditures ~ enrolled</code>) using the matched data, weighting by the <code>weights</code> column that <code>matchit()</code> generated. What is the causal effect of HISP on health expenditures? How does this compare to the naive model? Which do you believe more? Why?</li>
<li>Show the results from the two regressions in a side-by-side table if you want</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do that here, either in one big chunk, or in smaller chunks with text in</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between where you answer the questions (preferred)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-3-diff-in-diff" class="level1">
<h1>Task 3: Diff-in-diff</h1>
<p>Instead of using experimental data, we can estimate the causal effect using observational data alone with a difference-in-difference approach. We have data indicating if households were enrolled in the program (<code>enrolled</code>) and data indicating if they were surveyed before or after the intervention (<code>round</code>), which means we can find the differences between enrolled/not enrolled before and after the program.</p>
<p>Do the following:</p>
<ul>
<li>Make a new dataset based on <code>hisp</code> that only includes observations from the localities that were randomly chosen for treatment (<code>treatment_locality == "Treatment"</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do that here, either in one big chunk, or in smaller chunks with text in</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between where you answer the questions (preferred)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>hisp_local<span class="ot">&lt;-</span>hisp<span class="sc">|&gt;</span><span class="fu">filter</span>(treatment_locality<span class="sc">==</span><span class="st">'Treatment'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Using that new dataset, run a regression model that estimates the difference-in-difference effect of being enrolled in the HISP program (huge hint: use <code>health_expenditures ~ enrolled + round + enrolled * round</code>). Use <code>lm_robust()</code> and cluster by <code>locality_identifier</code> if you’re brave. What is the causal effect of HISP on health expenditures?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>m_did1<span class="ot">&lt;-</span><span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> enrolled <span class="sc">+</span> round <span class="sc">+</span> enrolled <span class="sc">*</span> round,<span class="at">clusters =</span> locality_identifier ,<span class="at">data=</span>hisp_local)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Run a second model that estimates the difference-in-difference effect, but control for the following variables: <code>age_hh + age_sp + educ_hh + educ_sp + female_hh + indigenous + hhsize + dirtfloor + bathroom + land + hospital_distance</code>. (Again, cluster by <code>locality_identifier</code> if you’re brave.) How does the causal effect change?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>m_did2<span class="ot">&lt;-</span><span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> enrolled <span class="sc">+</span> round <span class="sc">+</span> enrolled <span class="sc">*</span> round<span class="sc">+</span>age_hh <span class="sc">+</span> age_sp <span class="sc">+</span> educ_hh <span class="sc">+</span> educ_sp <span class="sc">+</span> female_hh <span class="sc">+</span> indigenous <span class="sc">+</span> hhsize <span class="sc">+</span> dirtfloor <span class="sc">+</span> bathroom <span class="sc">+</span> land <span class="sc">+</span> hospital_distance,<span class="at">clusters =</span> locality_identifier ,<span class="at">data=</span>hisp_local)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Show the results from the two regressions in a side-by-side table if you want</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(m_did1,m_did2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 20.791 </td>
   <td style="text-align:center;"> 27.395 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.174) </td>
   <td style="text-align:center;"> (0.561) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> enrolledEnrolled </td>
   <td style="text-align:center;"> −6.302 </td>
   <td style="text-align:center;"> −1.513 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.194) </td>
   <td style="text-align:center;"> (0.130) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> roundAfter </td>
   <td style="text-align:center;"> 1.513 </td>
   <td style="text-align:center;"> 1.451 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.360) </td>
   <td style="text-align:center;"> (0.359) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> enrolledEnrolled × roundAfter </td>
   <td style="text-align:center;"> −8.163 </td>
   <td style="text-align:center;"> −8.161 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.321) </td>
   <td style="text-align:center;"> (0.321) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age_hh </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.080 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.011) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age_sp </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.020 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educ_hh </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.060 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.029) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educ_sp </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.077 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.034) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> female_hh </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 1.104 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.318) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> indigenous </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −2.312 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.239) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hhsize </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −1.995 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.039) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dirtfloor </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −2.300 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.165) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> bathroom </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.500 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.160) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> land </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.091 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.029) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hospital_distance </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.003 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.003) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 9919 </td>
   <td style="text-align:center;"> 9919 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.344 </td>
   <td style="text-align:center;"> 0.552 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 69189.4 </td>
   <td style="text-align:center;"> 65431.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 69225.4 </td>
   <td style="text-align:center;"> 65546.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 7.91 </td>
   <td style="text-align:center;"> 6.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Std.Errors </td>
   <td style="text-align:center;"> by: locality_identifier </td>
   <td style="text-align:center;"> by: locality_identifier </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="task-4-rdd" class="level1">
<h1>Task 4: RDD</h1>
<p>Eligibility for the HISP is determined by income. Households that have an income of less than 58 on a standardized 1-100 scale (<code>poverty_index</code>) qualify for the program and are automatically enrolled. Because we have an arbitrary cutoff in a running variable, we can use regression discontinuity to measure the effect of the program on health expenditures.</p>
<p>Do the following:</p>
<ul>
<li>Make a new dataset based on <code>hisp</code> that only includes observations from the localities that were randomly chosen for treatment (<code>treatment_locality == "Treatment"</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>hisp_rdd<span class="ot">&lt;-</span>hisp<span class="sc">|&gt;</span><span class="fu">filter</span>(treatment_locality<span class="sc">==</span><span class="st">'Treatment'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Use <code>mutate()</code> to add new variable that centers the poverty index variable at 58</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hisp_rdd<span class="ot">&lt;-</span>hisp_rdd<span class="sc">|&gt;</span><span class="fu">mutate</span>(<span class="at">poverty_centered=</span>poverty_index<span class="dv">-58</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Determine if the discontinuity is sharp or fuzzy. (Hint: create a scatterplot with <code>poverty_index</code> on the x-axis, <code>enrolled</code> on the y-axis, and a vertical line at 58.)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hisp_rdd)<span class="sc">+</span><span class="fu">aes</span>(<span class="at">x=</span>poverty_index,<span class="at">y=</span>enrolled)<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">58</span>)<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="your-name_problem-set-8_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Determine if the distribution of the running variable (<code>poverty_index</code>) has a jump near the cutoff (it shouldn’t). (Hint: create a histogram with <code>poverty_index</code> on the x-axis and a vertical line at 58. Use a McCrary test to see if there’s a significant break in the distribution at 58.)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hisp_rdd, <span class="fu">aes</span>(<span class="at">x =</span> poverty_index)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">58</span>) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Poverty Index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="your-name_problem-set-8_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also conduct a McCrary density test, to examine this more formally.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>test_density <span class="ot">&lt;-</span> <span class="fu">rdplotdensity</span>(<span class="at">rdd =</span> <span class="fu">rddensity</span>(hisp_rdd<span class="sc">$</span>poverty_index, <span class="at">c =</span> <span class="dv">58</span>), </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">X =</span> hisp_rdd<span class="sc">$</span>poverty_index, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">type =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.
ℹ The deprecated feature was likely used in the lpdensity package.
  Please report the issue to the authors.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="your-name_problem-set-8_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Visualize the jump in outcome at the cutoff with a scatterplot (Hint: create a scatterplot with <code>poverty_index</code> on the x-axis, <code>health_expenditures</code> on the y-xis, color by <code>enrolled</code>, add a vertical line at 58, and add trendlines with <code>geom_smooth(method = "lm")</code>. You might want to adjust the size and transparency of the points with <code>geom_point(alpha = 0.2, size = 0.2)</code> or something similar.)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hisp_rdd)<span class="sc">+</span><span class="fu">aes</span>(<span class="at">x=</span>poverty_index,<span class="at">y=</span>health_expenditures,<span class="at">color=</span>enrolled)<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>,<span class="at">size=</span><span class="fl">0.2</span>)<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="your-name_problem-set-8_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Graphically, does it look like the HISP reduces health expenditures?</li>
<li>Build a parametric regression model to estimate the size of the gap at the cutoff. You’ll want to use the centered policy index variable to make it easier to interpret. You probably want to create a new dataset that only includes observations within some bandwidth that you choose (<code>filter(poverty_index_centered &gt;= SOMETHING &amp; poverty_index_centered &lt;= SOMETHING)</code>). How big is the effect?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_treat <span class="ot">&lt;-</span> hisp_rdd <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poverty_index_c=</span> poverty_index <span class="sc">-</span> <span class="dv">58</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>out_rdd <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> poverty_index_c <span class="sc">*</span> enrolled <span class="sc">+</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                           age_hh <span class="sc">+</span> age_sp <span class="sc">+</span> educ_hh <span class="sc">+</span> educ_sp <span class="sc">+</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                           female_hh <span class="sc">+</span> indigenous <span class="sc">+</span> hhsize <span class="sc">+</span> dirtfloor <span class="sc">+</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                           bathroom <span class="sc">+</span> land <span class="sc">+</span> hospital_distance,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> df_treat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Use <code>rdrobust()</code> from the <strong>rdrobust</strong> library to estimate the size of the gap nonparametrically. For the sake of simplicity, just use the default (automatic) bandwidth and kernel. How big is the effect?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>out_rdd_robust <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> enrolled <span class="sc">*</span> poverty_index_c <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                        enrolled <span class="sc">*</span> <span class="fu">I</span>(poverty_index_c<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                        enrolled <span class="sc">*</span> <span class="fu">I</span>(poverty_index_c<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                        age_hh <span class="sc">+</span> age_sp <span class="sc">+</span> educ_hh <span class="sc">+</span> educ_sp <span class="sc">+</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                        female_hh <span class="sc">+</span> indigenous <span class="sc">+</span> hhsize <span class="sc">+</span> dirtfloor <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                        bathroom <span class="sc">+</span> land <span class="sc">+</span> hospital_distance,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> df_treat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>out_rdd5 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> enrolled <span class="sc">*</span> poverty_index_c <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                           age_hh <span class="sc">+</span> age_sp <span class="sc">+</span> educ_hh <span class="sc">+</span> educ_sp <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                           female_hh <span class="sc">+</span> indigenous <span class="sc">+</span> hhsize <span class="sc">+</span> dirtfloor <span class="sc">+</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                           bathroom <span class="sc">+</span> land <span class="sc">+</span> hospital_distance,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> df_treat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'After'</span> <span class="sc">&amp;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">abs</span>(poverty_index_c) <span class="sc">&lt;=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(out_rdd,out_rdd_robust,out_rdd5))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
   <th style="text-align:center;"> Model 3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 29.221 </td>
   <td style="text-align:center;"> 28.952 </td>
   <td style="text-align:center;"> 29.617 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.945) </td>
   <td style="text-align:center;"> (1.049) </td>
   <td style="text-align:center;"> (1.597) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poverty_index_c </td>
   <td style="text-align:center;"> 0.171 </td>
   <td style="text-align:center;"> 0.324 </td>
   <td style="text-align:center;"> 0.403 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.041) </td>
   <td style="text-align:center;"> (0.214) </td>
   <td style="text-align:center;"> (0.240) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> enrolledEnrolled </td>
   <td style="text-align:center;"> −9.029 </td>
   <td style="text-align:center;"> −8.937 </td>
   <td style="text-align:center;"> −8.543 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.443) </td>
   <td style="text-align:center;"> (0.755) </td>
   <td style="text-align:center;"> (0.860) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age_hh </td>
   <td style="text-align:center;"> 0.091 </td>
   <td style="text-align:center;"> 0.092 </td>
   <td style="text-align:center;"> 0.061 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.020) </td>
   <td style="text-align:center;"> (0.020) </td>
   <td style="text-align:center;"> (0.027) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age_sp </td>
   <td style="text-align:center;"> −0.055 </td>
   <td style="text-align:center;"> −0.055 </td>
   <td style="text-align:center;"> −0.023 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.023) </td>
   <td style="text-align:center;"> (0.023) </td>
   <td style="text-align:center;"> (0.031) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educ_hh </td>
   <td style="text-align:center;"> −0.067 </td>
   <td style="text-align:center;"> −0.072 </td>
   <td style="text-align:center;"> −0.060 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.058) </td>
   <td style="text-align:center;"> (0.058) </td>
   <td style="text-align:center;"> (0.092) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educ_sp </td>
   <td style="text-align:center;"> −0.139 </td>
   <td style="text-align:center;"> −0.136 </td>
   <td style="text-align:center;"> −0.205 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.066) </td>
   <td style="text-align:center;"> (0.065) </td>
   <td style="text-align:center;"> (0.099) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> female_hh </td>
   <td style="text-align:center;"> 0.573 </td>
   <td style="text-align:center;"> 0.562 </td>
   <td style="text-align:center;"> 0.857 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.581) </td>
   <td style="text-align:center;"> (0.583) </td>
   <td style="text-align:center;"> (0.825) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> indigenous </td>
   <td style="text-align:center;"> −1.880 </td>
   <td style="text-align:center;"> −1.893 </td>
   <td style="text-align:center;"> −2.036 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.292) </td>
   <td style="text-align:center;"> (0.294) </td>
   <td style="text-align:center;"> (0.512) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hhsize </td>
   <td style="text-align:center;"> −1.979 </td>
   <td style="text-align:center;"> −1.977 </td>
   <td style="text-align:center;"> −2.041 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.069) </td>
   <td style="text-align:center;"> (0.069) </td>
   <td style="text-align:center;"> (0.103) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dirtfloor </td>
   <td style="text-align:center;"> −1.756 </td>
   <td style="text-align:center;"> −1.764 </td>
   <td style="text-align:center;"> −1.926 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.304) </td>
   <td style="text-align:center;"> (0.305) </td>
   <td style="text-align:center;"> (0.488) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> bathroom </td>
   <td style="text-align:center;"> 0.570 </td>
   <td style="text-align:center;"> 0.571 </td>
   <td style="text-align:center;"> 0.101 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.272) </td>
   <td style="text-align:center;"> (0.272) </td>
   <td style="text-align:center;"> (0.459) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> land </td>
   <td style="text-align:center;"> −0.048 </td>
   <td style="text-align:center;"> −0.050 </td>
   <td style="text-align:center;"> −0.014 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.043) </td>
   <td style="text-align:center;"> (0.043) </td>
   <td style="text-align:center;"> (0.074) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hospital_distance </td>
   <td style="text-align:center;"> −0.006 </td>
   <td style="text-align:center;"> −0.006 </td>
   <td style="text-align:center;"> −0.006 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.004) </td>
   <td style="text-align:center;"> (0.004) </td>
   <td style="text-align:center;"> (0.006) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poverty_index_c × enrolledEnrolled </td>
   <td style="text-align:center;"> −0.198 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.046) </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> I(poverty_index_c^2) </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.016 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.018) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> I(poverty_index_c^3) </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.000 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.000) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> enrolledEnrolled × poverty_index_c </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.390 </td>
   <td style="text-align:center;"> −0.415 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.260) </td>
   <td style="text-align:center;"> (0.309) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> enrolledEnrolled × I(poverty_index_c^2) </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.015 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.022) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> enrolledEnrolled × I(poverty_index_c^3) </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.000 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.001) </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 4960 </td>
   <td style="text-align:center;"> 4960 </td>
   <td style="text-align:center;"> 1879 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.458 </td>
   <td style="text-align:center;"> 0.459 </td>
   <td style="text-align:center;"> 0.406 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 36043.8 </td>
   <td style="text-align:center;"> 36048.8 </td>
   <td style="text-align:center;"> 13711.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 36148.0 </td>
   <td style="text-align:center;"> 36179.0 </td>
   <td style="text-align:center;"> 13800.5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 9.13 </td>
   <td style="text-align:center;"> 9.12 </td>
   <td style="text-align:center;"> 9.22 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do that here, either in one big chunk, or in smaller chunks with text in</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between where you answer the questions (preferred)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-5-ivs2sls" class="level1">
<h1>Task 5: IVs/2SLS</h1>
<p>Finally, we can use an instrument to remove the endogeneity from the choice to enroll in the HISP and estimate the causal effect from observational data. As you read in chapter 5, World Bank evaluators randomly selected households to receive encouragement to enroll in HISP. You can use this encouragement as an instrument for enrollment.</p>
<p>Do the following:</p>
<ul>
<li>Create a dataset based on <code>hisp</code> that only includes observations from after the intervention (<code>round == "After"</code>)</li>
<li>Build a naive regression model that estimates the effect of HISP enrollment on health expenditures. You’ll need to use the <code>enrolled_rp</code> variable instead of <code>enrolled</code>, since we’re measuring enrollment after the encouragement intervention. (Hint: you’ll want to use <code>health_expenditures ~ enrolled_rp</code>.) What does this naive model tell us about the effect of enrolling in HISP?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>naive_mod<span class="ot">&lt;-</span><span class="fu">lm</span>(health_expenditures<span class="sc">~</span>enrolled_rp,<span class="at">data =</span> hisp<span class="sc">|&gt;</span><span class="fu">filter</span>(round<span class="sc">==</span><span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>m_enroll <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(enrolled_rp <span class="sc">~</span> promotion_locality,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">clusters =</span> locality_identifier,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> hisp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>m_base_health <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> promotion_locality,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">clusters =</span> locality_identifier,<span class="at">data =</span> hisp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Check the relevance, exclusion, and exogeneity of promotion (<code>promotion_locality</code>) as an instrument. For relevance, you’ll want to run a model that predicts enrollment based on promotion (hint: <code>enrolled_rp ~ promotion_locality</code>) and check (1) the significance of the coefficient and (2) the F-statistic. For exclusion and exogeneity, you’ll have to tell a convincing story that proves promotion influences health expenditures <em>only through</em> HISP enrollment.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>m_enroll <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(enrolled_rp <span class="sc">~</span> promotion_locality,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">clusters =</span> locality_identifier,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> hisp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Run a 2SLS regression model with promotion as the instrument. You can do this by hand if you want (i.e.&nbsp;run a first stage model, extract predicted enrollment, and use predicted enrollment as the second stage), <em>or</em> you can just use the <code>iv_robust()</code> function from the <strong>estimatr</strong> library. (Hint: you’ll want to use <code>health_expenditures ~ enrolled_rp | promotion_locality</code> as the formula). After removing the endogeneity from enrollment, what is the casual effect of enrollment in the HISP on health expenditures?</li>
<li>Show the results from the two regressions in a side-by-side table if you want</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Conduct this estimation with and without covariate adjustment. Interpret.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>m_cace <span class="ot">&lt;-</span> <span class="fu">iv_robust</span>(health_expenditures <span class="sc">~</span> enrolled_rp <span class="sc">|</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                      promotion_locality,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">clusters =</span> locality_identifier,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> hisp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'After'</span>))</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>m_cace_wcov <span class="ot">&lt;-</span> <span class="fu">iv_robust</span>(health_expenditures <span class="sc">~</span> enrolled_rp <span class="sc">+</span> </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                           age_hh <span class="sc">+</span> age_sp <span class="sc">+</span> educ_hh <span class="sc">+</span> educ_sp <span class="sc">+</span> </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                           female_hh <span class="sc">+</span> indigenous <span class="sc">+</span> hhsize <span class="sc">+</span> dirtfloor <span class="sc">+</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                           bathroom <span class="sc">+</span> land <span class="sc">+</span> hospital_distance <span class="sc">|</span> </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                           promotion_locality <span class="sc">+</span> </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                           age_hh <span class="sc">+</span> age_sp <span class="sc">+</span> educ_hh <span class="sc">+</span> educ_sp <span class="sc">+</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                           female_hh <span class="sc">+</span> indigenous <span class="sc">+</span> hhsize <span class="sc">+</span> dirtfloor <span class="sc">+</span> </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>                           bathroom <span class="sc">+</span> land <span class="sc">+</span> hospital_distance ,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">clusters =</span> locality_identifier,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> hisp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'After'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do that here, either in one big chunk, or in smaller chunks with text in</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between where you answer the questions (preferred)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-6-summary" class="level1">
<h1>Task 6: Summary</h1>
<p>You just calculated a bunch of causal effects. List them here. Which one do you trust the most? Why?</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>